#!/usr/bin/env node

'use strict';
 
const fs = require('fs')
const path = require('path')

const home = require('home')()
const _ = require('lodash')
const program = require('commander')

const utils = require('../lib/utils')
const pkg = require('../package.json')
const Everblog = require('../lib/everblog')

// Put them in util for easy mocha testing.
const buildBlog = utils.buildBlog;
const startBlog = utils.startBlog;

const log = utils.log;
const error = utils.error;

const configPath = path.join(home, '.everblogrc')

program
  .version(pkg.version)
  .usage('[command]')

program
  .command('config')
  .description('list config')
  .action(configBlog)

program
  .command('build')
  .description('build blog')
  .action(function(){
      buildBlog().then(function(){
        log('build finished');
    });
  })

program
  .command('start')
  .description('build and start blog')
  .action(startBlog)

program.parse(process.argv);

if (process.argv.length === 2) {
  program.outputHelp();
}

function configBlog() {
  try {
    const dir = process.cwd()
    log(dir)
    log(fs.readFileSync(configPath))
  } catch (e) {
    error('Failed in reading ' + configPath)
    error('Please you have a ~/.everblogrc:\n\n  token: "xxx"\n  noteStoreUrl: "xxx"\n  notebook: "xxx"')
  }
}


